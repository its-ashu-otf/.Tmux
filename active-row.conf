#
# General Settings
#
set -g status-right ''
set -g status-left ''
set -g history-limit 100000

# Mouse support - set to on if you want to use the mouse

set -g mouse on

# Start index of window/pane with 1, because we're humans, not computers
set -g base-index 1
setw -g pane-base-index 1

# set terminal title
set -g set-titles on  

#
# Configure prefix
#
unbind C-b
set -g prefix C-a

# create session
bind C-c new-session

# find session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# Reload tmux configuration 
bind C-r source-file ~/.tmux.conf \; display "Config reloaded"

#
# Prefixed commands
#

# Create a new window (Ctrl + A, Ctrl + c)
bind C-c new-window

# Create a new nested tmux (Ctrl + A, Ctrl + s)
bind C-s new-window ~/.tmux.conf.d/my_tmux_configuration/new-tmux \; \
         rename-window '' \; \
         command-prompt -I "#W" "rename-window -- '%%'"

# Switch to last window (Ctrl + A, Ctrl + A)
bind C-a last-window

# Rename current window (Ctrl + A, A)
bind A  rename-window '' \; \
        command-prompt -I "#W" "rename-window -- '%%'"

# Enable search mode
bind -T copy-mode -n / command-prompt -i -I "#{pane_search_string}" -p "(search down)" "send -X search-forward-incremental \"%%%\""

#
# Non-prefixed commands
#

# Go to next window (Alt + Right)
bind -n M-right next

# Go to previous window (Alt + Left)
bind -n M-left  prev

# Create new window (Ctrl + t)
bind -n C-t new-window

# Switch to inner tmux (Alt + Up)
bind -n M-up send-keys M-F12

# Switch to outer tmux (Alt + Down)
bind -n M-down source-file ~/.tmux.conf.d/my_tmux_configuration/inactive-row.conf \; \
               run-shell 'tmux -L $TMUX_PARENT source-file ~/.tmux.conf.d/my_tmux_configuration/active-row.conf' \; \
               run-shell 'tmux -L $TMUX_PARENT set -g window-status-current-style bg=$active_window_bg'

# Handler for becoming active (Alt + F12, don't use directly)
bind -n M-F12 run-shell 'tmux -L $TMUX_PARENT source-file ~/.tmux.conf.d/my_tmux_configuration/inactive-row.conf' \; \
              source-file ~/.tmux.conf.d/my_tmux_configuration/active-row.conf \; \
              set -g window-status-current-style bg=$active_window_bg

# Handler for closed window: enable outer terminal
set-hook -g client-detached "run-shell 'tmux -L $TMUX_PARENT source-file ~/.tmux.conf.d/my_tmux_configuration/active-row.conf && tmux -L $TMUX_PARENT set -g window-status-current-style bg=$active_window_bg'"

# If we're the root tmux, unbind M-down
if-shell 'test -z "$TMUX_PARENT"' 'bind -n M-down send-keys ""' ''

# When a new session is created unbind the parent
if-shell 'test -z "$TMUX_PARENT"' '' 'run-shell "tmux -L $TMUX_PARENT source-file ~/.tmux.conf.d/nested-tmux/inactive-row.conf"'
